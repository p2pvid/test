"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Pow = void 0;
const grpc_authentication_1 = require("@textile/grpc-authentication");
const loglevel_1 = __importDefault(require("loglevel"));
const api_1 = require("./api");
const logger = loglevel_1.default.getLogger('pow');
/**
 * Pow a client wrapper for interacting with the Textile Powergate API.
 * @example
 * Initialize the Bucket API and open an existing bucket (or create if new).
 * ```typescript
 * import { Pow, PrivateKey, UserAuth } from '@textile/hub'
 *
 * const checkHealth = async (auth: UserAuth, user: PrivateKey) => {
 *   const pow = Pow.withUserAuth(auth)
 *   // Scope the API to the current user
 *   await pow.getToken(user)
 *   // List adrs
 *   const health = pow.health()
 * }
 * ```
 */
class Pow extends grpc_authentication_1.GrpcAuthentication {
    /**
     * {@inheritDoc @textile/hub#GrpcAuthentication.copyAuth}
     *
     * @example
     * Copy an authenticated Users api instance to Pow.
     * ```typescript
     * import { Pow, Users } from '@textile/hub'
     *
     * const usersToPow = async (user: Users) => {
     *   const pow = Pow.copyAuth(user)
     *   return pow
     * }
     * ```
     *
     * @example
     * Copy an authenticated Pow api instance to Users.
     * ```typescript
     * import { Pow, Users } from '@textile/hub'
     *
     * const powToUsers = async (pow: Pow) => {
     *   const user = Users.copyAuth(pow)
     *   return user
     * }
     * ```
     */
    static copyAuth(auth, options) {
        return new Pow(auth.context, options === null || options === void 0 ? void 0 : options.debug);
    }
    /**
     * {@inheritDoc @textile/hub#GrpcAuthentication.withUserAuth}
     *
     * @example
     * ```@typescript
     * import { Pow, UserAuth } from '@textile/hub'
     *
     * async function example (userAuth: UserAuth) {
     *   const pow = await Pow.withUserAuth(userAuth)
     * }
     * ```
     */
    static withUserAuth(auth, options) {
        const res = super.withUserAuth(auth, options);
        return this.copyAuth(res, options);
    }
    /**
     * {@inheritDoc @textile/hub#GrpcAuthentication.withKeyInfo}
     *
     * @example
     * ```@typescript
     * import { Pow, KeyInfo } from '@textile/hub'
     *
     * async function start () {
     *   const keyInfo: KeyInfo = {
     *     key: '<api key>',
     *     secret: '<api secret>'
     *   }
     *   const pow = await Pow.withKeyInfo(keyInfo)
     * }
     * ```
     */
    static withKeyInfo(key, options) {
        const _super = Object.create(null, {
            withKeyInfo: { get: () => super.withKeyInfo }
        });
        return __awaiter(this, void 0, void 0, function* () {
            const auth = yield _super.withKeyInfo.call(this, key, options);
            return this.copyAuth(auth, options);
        });
    }
    /**
     * {@inheritDoc @textile/hub#GrpcAuthentication.getToken}
     *
     * @example
     * ```@typescript
     * import { Pow, PrivateKey } from '@textile/hub'
     *
     * async function example (pow: Pow, identity: PrivateKey) {
     *   const token = await pow.getToken(identity)
     *   return token // already added to `pow` scope
     * }
     * ```
     */
    getToken(identity) {
        const _super = Object.create(null, {
            getToken: { get: () => super.getToken }
        });
        return __awaiter(this, void 0, void 0, function* () {
            return _super.getToken.call(this, identity);
        });
    }
    /**
     * {@inheritDoc @textile/hub#GrpcAuthentication.getTokenChallenge}
     *
     * @example
     * ```typescript
     * import { Pow, PrivateKey } from '@textile/hub'
     *
     * async function example (pow: Pow, identity: PrivateKey) {
     *   const token = await pow.getTokenChallenge(
     *     identity.public.toString(),
     *     (challenge: Uint8Array) => {
     *       return new Promise((resolve, reject) => {
     *         // This is where you should program PrivateKey to respond to challenge
     *         // Read more here: https://docs.textile.io/tutorials/hub/production-auth/
     *       })
     *     }
     *   )
     *   return token
     * }
     * ```
     */
    getTokenChallenge(publicKey, callback) {
        const _super = Object.create(null, {
            getTokenChallenge: { get: () => super.getTokenChallenge }
        });
        return __awaiter(this, void 0, void 0, function* () {
            return _super.getTokenChallenge.call(this, publicKey, callback);
        });
    }
    /**
     * @beta
     */
    health() {
        return __awaiter(this, void 0, void 0, function* () {
            return api_1.health(this);
        });
    }
    /**
     * Gets the Powergate node Filecoin peers. This method
     * requires a valid user, token, and session.
     * @beta
     *
     * @example
     * ```typescript
     * import { Pow } from "@textile/hub"
     *
     * async function example(pow: Pow) {
     *    const peersResp = await pow.peers()
     * }
     * ```
     */
    peers() {
        return __awaiter(this, void 0, void 0, function* () {
            return api_1.peers(this);
        });
    }
    /**
     * Find a peer by peer id.
     * @beta
     * @param peerId The peer id of the peer you want to find.
     */
    findPeer(peerId) {
        return __awaiter(this, void 0, void 0, function* () {
            return api_1.findPeer(this, peerId);
        });
    }
    /**
     * Query for network connectedness to the specified peer.
     * @beta
     * @param peerId The peer id to test connectedness for.
     */
    connectedness(peerId) {
        return __awaiter(this, void 0, void 0, function* () {
            return api_1.connectedness(this, peerId);
        });
    }
    /**
     * List all Filecoin wallet addresses associated with the current account or user.
     * @beta
     */
    addrs() {
        return __awaiter(this, void 0, void 0, function* () {
            return api_1.addrs(this);
        });
    }
    /**
     * Create a new Filecoin wallet address.
     * @beta
     * @param name A human readable name for the wallet address.
     * @param type The type of address to create, wither bls or secp256k1.
     * @param makeDefault Whether or not to make the new address the default address to use in Filecoin transactions.
     */
    newAddr(name, type, makeDefault) {
        return __awaiter(this, void 0, void 0, function* () {
            return api_1.newAddr(this, name, type, makeDefault);
        });
    }
    /**
     * Query for general information about Powergate associated with the current account/user.
     * @beta
     */
    info() {
        return __awaiter(this, void 0, void 0, function* () {
            return api_1.info(this);
        });
    }
    /**
     * Show information about data stored in Powergate.
     * @beta
     * @param cid The cid of the data to show information about.
     */
    show(cid) {
        return __awaiter(this, void 0, void 0, function* () {
            return api_1.show(this, cid);
        });
    }
    /**
     * Show information for all data stored in Powergate for the current account/user.
     * @beta
     */
    showAll() {
        return __awaiter(this, void 0, void 0, function* () {
            return api_1.showAll(this);
        });
    }
    /**
     * Query for Filecoin storage deal records for the current account/user.
     * @beta
     * @param config A config object to control the behavior of the query.
     */
    listStorageDealRecords(config) {
        return __awaiter(this, void 0, void 0, function* () {
            return api_1.listStorageDealRecords(this, config);
        });
    }
    /**
     * Query for Filecoin retrieval deal records for the current account/user.
     * @beta
     * @param config A config object to control the behavior of the query.
     */
    listRetrievalDealRecords(config) {
        return __awaiter(this, void 0, void 0, function* () {
            return api_1.listRetrievalDealRecords(this, config);
        });
    }
    /**
     * Get the balance for any wallet address.
     * @beta
     * @param address The wallet address to check the balance of.
     */
    balance(address) {
        return __awaiter(this, void 0, void 0, function* () {
            return api_1.balance(this, address);
        });
    }
}
exports.Pow = Pow;
//# sourceMappingURL=pow.js.map